<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>播放视频</title>
    <link href="../css/video-js.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../layui/css/layui.css">
    <style>
        body {
            background-color: #191919
        }

        .m {
            width: 960px;
            height: 400px;
            margin-left: auto;
            margin-right: auto;
            margin-top: 100px;
        }

        .hideFileBtn {
            opacity: 0;
            width: 50px;
            display: inline;
            overflow: hidden;
        }
    </style>
</head>
<body>


<div class="layui-fluid" id="screenHeight">

    <div class="layui-row" style="height: 90%">
        <div class="layui-col-xs6" style="height: 95%;background-image: url(../img/videoPause.png); background-repeat: no-repeat;background-position: 50%;
    background-size:auto 100%;margin-top: 0.5%">
            <div class="video1 videos">
                <!--video1-->
            </div>
        </div>
        <div class="layui-col-xs6" style="height: 95%;margin-top: 0.5%;">

            <div class="layui-row" style="height: 50%;">
                <div class="layui-col-xs6" style="height: 100%;background-image: url(../img/videoPause.png);
    background-repeat: no-repeat;
    background-position: 50%;
    background-size: auto 100%;">
                    <!--video2-->
                    <div class="video2 videos">

                    </div>
                </div>
                <div class="layui-col-xs6" style="height: 100%;background-image: url(../img/videoPause.png);
    background-repeat: no-repeat;
    background-position: 50%;
    background-size: auto 100%;">
                    <!--video3-->
                    <div class="video3 videos">

                    </div>
                </div>

            </div>


            <div class="layui-row" style="height: 50%;">
                <div class="layui-col-xs6" style="height: 100%;background-image: url(../img/videoPause.png);
    background-repeat: no-repeat;
    background-position: 50%;
    background-size:auto 100%;">
                    <!--video4-->
                    <div class="video4 videos">

                    </div>
                </div>
                <div class="layui-col-xs6" style="height: 100%;background-image: url(../img/videoPause.png);
    background-repeat: no-repeat;
    background-position: 50%;
    background-size: auto 100%;">
                    <!--video5-->
                    <div class="video5 videos">

                    </div>
                </div>
            </div>


        </div>


        <!--<input id=b type=file webkitdirectory>-->
    </div>

    <div class="layui-row"
         style=" justify-content: center;height: 8%;background-color: #fff; text-align: center;display: flex;align-items: center;">
        <i class="layui-icon layui-icon-list chooseVideo"
           title="请选择视频文件夹"
           style="font-size: 50px; color: #191919;font-weight: bold;margin-right: 50px; position: relative;    display: flex;">
            <input id=b type=file webkitdirectory class="hideFileBtn" style="position: absolute;">
        </i>
        <i class="layui-icon layui-icon-add-1 addAnoation" style="font-size: 50px; color: #191919;font-weight: bold;">
        </i>
    </div>

</div>


<!--<div class="m"></div>-->


<script src="../js/jquery.min.js"></script>
<script src="../layui/layui.all.js"></script>
<script src="../js/video7.5.5/js/video.min.js"></script>

<script>

    var folderName = '';
    var screenHeight = 0;

    screenHeight = document.documentElement.clientHeight - 8;
    // console.log(screenHeight);
    if (screenHeight > 0) {
        $('#screenHeight').attr('style', `height:${screenHeight}px`);
    }


    var videoCollection = [], blobb = [];


    document.querySelector('#b').addEventListener('change', e => {
        $('#my-video0').attr('src','');
        $('#my-video1').attr('src','');
        $('#my-video2').attr('src','');
        $('#my-video3').attr('src','');
        $('#my-video4').attr('src','');
        // console.log( $('#my-video0').attr('src'));
        $('.videos').empty();
        blobb = [];

        var vdo = e.target;
        var totalPath = vdo.files[0].webkitRelativePath;
        var vdoName = vdo.files[0].name;
        //截取字符串
        var start = totalPath.indexOf(vdoName);
        folderName = totalPath.substring(0, start).split('/')[0];


        /*   for (let entry of e.target.files){
               console.log(entry.name, entry.webkitRelativePath);
           }*/


        for (let i = 0; i < e.target.files.length; i++) {
            videoCollection.push(e.target.files[i].webkitRelativePath);
            blobb.push(window.URL.createObjectURL(e.target.files[i]));
        }



        var str = '';
        //获取5个视频
        /*     for (let i = 0; i < videoCollection.length; i++) {
                 str = `<video id="my-video${i}" class="video-js" controls preload="auto" width="360" height="120" data-setup="{}">
                 <source src=${blobb[i]} type="video/mp4">
                 <p class="vjs-no-js"> To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a> </p>
             </video>`;
             }*/

        $('.video1').append(`<video id="my-video0"  src=${blobb[0]} type="video/webm" class="video-js" controls preload="auto"   data-setup="{}" style="object-fit: fill;">
			<source>
			<p class="vjs-no-js"> To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a> </p>
		</video>`);
        $('.video2').append(`<video id="my-video1" src=${blobb[1]} type="video/mp4" class="video-js"  controls preload="auto" width="360" height="120" data-setup="{}"  style="object-fit: fill;">
			<source >
			<p class="vjs-no-js"> To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a> </p>
		</video>`);
        $('.video3').append(`<video id="my-video2" src=${blobb[2]} type="video/mp4" class="video-js"  controls preload="auto" width="360" height="120" data-setup="{}"  style="object-fit: fill;">
			<source >
			<p class="vjs-no-js"> To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a> </p>
		</video>`);
        $('.video4').append(`<video id="my-video3" src=${blobb[3]} type="video/mp4" class="video-js" controls preload="auto" width="360" height="120" data-setup="{}"  style="object-fit: fill;">
			<source >
			<p class="vjs-no-js"> To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a> </p>
		</video>`);
        $('.video5').append(`<video id="my-video4" src=${blobb[4]} type="video/mp4" class="video-js" controls preload="auto" width="360" height="120" data-setup="{}"  style="object-fit: fill;">
			<source >
			<p class="vjs-no-js"> To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a> </p>
		</video>`);

        $('#my-video0').css('height', screenHeight * 0.863 + 'px').css('width', '100%');
        $('#my-video1').css('height', screenHeight * 0.87 * 0.5 + 'px').css('width', '100%');
        $('#my-video2').css('height', screenHeight * 0.87 * 0.5 + 'px').css('width', '100%');
        $('#my-video3').css('height', screenHeight * 0.87 * 0.5 + 'px').css('width', '100%');
        $('#my-video4').css('height', screenHeight * 0.87 * 0.5 + 'px').css('width', '100%');


        //	监听播放时间
        var video0 = document.getElementById('my-video0');
        var video1 = document.getElementById('my-video1');
        var video2 = document.getElementById('my-video2');
        var video3 = document.getElementById('my-video3');
        var video4 = document.getElementById('my-video4');
        //	播放
        video0.addEventListener('play', function () {
            video1.play();
            video2.play();
            video3.play();
            video4.play();
        });
        //	暂停
        video0.addEventListener('pause', function () {
            video1.pause();
            video2.pause();
            video3.pause();
            video4.pause();
            var timeDisplay = Math.floor(video0.currentTime);
            localStorage.setItem('screenShot', timeDisplay);

        });
        //
        document.onmouseup = function () {
            video1.currentTime = video0.currentTime;
            video2.currentTime = video0.currentTime;
            video3.currentTime = video0.currentTime;
            video4.currentTime = video0.currentTime;
        }
    });


    //截图
    $(".addAnoation").bind("click", function () {
        if ($(this).attr("disabled")) {
            return;
        }
        captureImage($("#my-video0").get(0));


    });


    function captureImage(video) {
        if (video == undefined) {
            layer.msg('请先选择视频文件');
            return false;
        }
        var canvas = document.createElement("canvas");
        var ctx = canvas.getContext("2d");
        canvas.width = 1100;
        canvas.height = 600;

        var image = new Image();

        image.setAttribute("crossOrigin", "Anonymous");
        image.setAttribute("class", "red_img");
        ctx.drawImage(video, 0, 0, 1100, 600);
        image.src = canvas.toDataURL("image/png", 1.0);
        localStorage.setItem('base64IMG', image.src);

        setTimeout(function () {

            //使用layer作为标注模态层
            layui.use('layer', function () {
                var layer = layui.layer;
                layer.open({
                    type: 2,
                    area: ['100%', '100%'],
                    title: false,
                    closeBtn: false,
                    content: `./screenshot.html?folderName=${folderName}`,
                    btnAlign: "c",
                    btn: "关闭",
                    yes: function () {
                        layer.closeAll();

                    }
                });

            });
        }, 500)

    }

</script>
</body>
</html>


